package coap.kafka;

import org.eclipse.californium.core.coap.Request;
import org.eclipse.californium.core.coap.Response;

public class CoapIoTClient {
	
	private static String url = "coap://[aaaa::c30c:0:0:2]:5683/sensors/light";
	
	public static void main(String[] args) {
		Request request = Request.newGet();
		
		final ReCEP recep = new ReCEP();
		
		request.setURI(url);
		request.setObserve();
		
		try {
			while (true) {
				request.send();
				//what should be the optimum value for waiting response
				Response response = request.waitForResponse(1000);
				
				if (null != response) {
					//parse the input string to obtain mote-id and lux value
					String responseString = response.toString();
					String delim = "[;]";
					String[] res = responseString.split("\"");
					String[] tokens = res[res.length-1].split(delim);
					
					int mote_id = Integer.parseInt(tokens[0]);
					int val = Integer.parseInt(tokens[1]);
					recep.send(mote_id, val);
					
				} //if (null...)
				else {
					System.out.println("No Response ");
				}
			} //while
		} catch (InterruptedException e) {
            System.err.println("Receiving of response interrupted: " + e.getMessage());
            System.exit(-1);
        }
	}
}
